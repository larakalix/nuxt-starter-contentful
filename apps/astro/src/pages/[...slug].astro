---
import Layout from "../layouts/Layout.astro";
import { Error as ErrorComponent } from "@starter/ui/organisms";
import { FunnelPageSections } from "@starter/ui/pages";
import { loadFunnelPage } from "../server/funnel-page";
import { getPostsLinks } from "@starter/content";
import type { OnNavigate } from "@starter/ui/atoms";

export async function getStaticPaths() {
    const paths = await getPostsLinks();

    return [
        { params: { slug: "" } },
        { params: { slug: "home" } },
        { params: { slug: "about" } },
        ...paths.map((path) => ({
            params: { slug: path.href },
        })),
    ];
}

const { slug } = Astro.params;
const { funnelPage, error } = await loadFunnelPage(slug);

const onNavigate: OnNavigate = (href, event) => {
    event?.preventDefault();
    window.location.assign(href);
};
---

<Layout>
    <!-- Error state -->
    {error && <ErrorComponent message={error?.message} />}

    <!-- Success state -->
    <FunnelPageSections
        client:visible
        funnelPage={{
            ...funnelPage?.page,
            skipWrapper: false,
        }}
        onNavigate={onNavigate}
    />
</Layout>
