---
import Layout from "../layouts/Layout.astro";
import { FunnelPageSections } from "@starter/ui/pages";
import { Error as ErrorComponent } from "@starter/ui/organisms";
import { parseSlugParam, loadFunnelPage } from "../server/funnel-page";
import type { OnNavigate } from "@starter/ui/atoms";

export async function getStaticPaths() {
    return [
        { params: { slug: "" } },
        { params: { slug: "home" } },
        { params: { slug: "about" } },
    ];
}

const { slug } = Astro.params;
const { path, id } = parseSlugParam(slug);
const { funnelPage, error } = await loadFunnelPage(path);

const onNavigate: OnNavigate = (href, event) => {
    event?.preventDefault();
    window.location.assign(href);
};
---

<Layout>
    <!-- Error state -->
    {error && <ErrorComponent message={error?.message} />}

    <!-- Success state -->
    <FunnelPageSections
        client:visible
        funnelPage={{
            ...funnelPage,
            skipWrapper: false,
        }}
        onNavigate={onNavigate}
    />
</Layout>
